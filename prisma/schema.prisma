generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model account_ledger {
  ledger_id      Int                         @id @default(autoincrement())
  account_type   account_ledger_account_type
  account_id     Int
  reference_type String?                     @db.VarChar(50)
  reference_id   Int?
  debit          Decimal?                    @default(0.00) @db.Decimal(15, 2)
  credit         Decimal?                    @default(0.00) @db.Decimal(15, 2)
  created_at     DateTime                    @default(now()) @db.Timestamp(0)

  @@index([account_type, account_id], map: "idx_ledger_account")
}

model agrivet_transactions {
  transaction_id   Int      @id @default(autoincrement())
  ref_id           String   @db.VarChar(50)
  transaction_date DateTime @db.Date
  transaction_type String   @db.VarChar(50)
  account_name     String?  @db.VarChar(100)
  fund_source      String?  @db.VarChar(50)
  amount           Decimal? @db.Decimal(15, 2)
  remarks          String?  @db.VarChar(255)
}

model customers {
  customer_id     Int               @id @default(autoincrement())
  customer_name   String            @unique(map: "unique_customer_name") @db.VarChar(255)
  customer_type   String            @db.VarChar(50)
  contact_number  String?           @db.VarChar(50)
  status          String?           @default("ACTIVE") @db.VarChar(50)
  created_at      DateTime?         @default(now()) @db.DateTime(0)
  is_active       Boolean?          @default(true)
  credit_balance  Decimal?          @default(0.00) @db.Decimal(15, 2)
  credit_limit    Decimal?          @default(0.00) @db.Decimal(15, 2)
  purchase_orders purchase_orders[]
  sales           sales[]
}

model delivery {
  delivery_id      Int       @id @default(autoincrement())
  sale_id          Int?
  delivery_date    DateTime? @db.Date
  delivery_address String?   @db.VarChar(255)
  delivery_status  String?   @db.VarChar(50)
  sales            sales?    @relation(fields: [sale_id], references: [sale_id], onDelete: Restrict, onUpdate: Restrict, map: "delivery_ibfk_1")

  @@index([sale_id], map: "fk_delivery_sale")
}

model employees {
  employee_id     Int               @id @default(autoincrement())
  employee_name   String            @db.VarChar(255)
  role            String            @db.VarChar(100)
  purchase_orders purchase_orders[]
  sales           sales[]
  stock_log       stock_log[]
  supply          supply[]
}

model inventory {
  inventory_id    Int       @id @default(autoincrement())
  product_id      Int?
  current_stock   Int?
  expiration_date DateTime? @db.Date
  batch_number    String?   @db.VarChar(100)
  is_active       Boolean   @default(true)
  products        products? @relation(fields: [product_id], references: [product_id], onDelete: Restrict, onUpdate: Restrict, map: "fk_inventory_product")

  @@index([product_id], map: "idx_inventory_product")
}

model products {
  product_id             Int                      @id @default(autoincrement())
  product_name           String                   @unique(map: "unique_product_name") @db.VarChar(255)
  category               String?                  @db.VarChar(100)
  unit_price             Decimal?                 @db.Decimal(10, 2)
  reorder_level          Int?
  inspection_interval    String?                  @db.VarChar(50)
  unit_type              String?                  @db.VarChar(50)
  unit_quantity          Int?
  status                 String?                  @db.VarChar(50)
  description            String?                  @db.VarChar(255)
  product_code           String?                  @db.VarChar(64)
  brand                  String?                  @db.VarChar(100)
  flavor                 String?                  @db.VarChar(100)
  pack_size              String?                  @db.VarChar(64)
  quantity_per_case      Int?
  srp                    Decimal?                 @db.Decimal(15, 2)
  dealer_price           Decimal?                 @db.Decimal(15, 2)
  srp_per_kilo           Decimal?                 @db.Decimal(12, 2)
  barcode                String?                  @db.VarChar(64)
  supplier_reference     String?                  @db.VarChar(100)
  supplier_id            Int?
  source                 products_source?         @default(local)
  is_active              Boolean?                 @default(true)
  created_at             DateTime?                @default(now()) @db.DateTime(0)
  unit                   String?                  @db.VarChar(50)
  inventory              inventory[]
  suppliers              suppliers?               @relation(fields: [supplier_id], references: [supplier_id], map: "fk_products_supplier")
  purchase_order_details purchase_order_details[]
  sale_details           sale_details[]
  stock_log              stock_log[]
  supply_details         supply_details[]

  @@index([supplier_id], map: "fk_products_supplier")
}

model purchase_order_details {
  po_detail_id    Int              @id @default(autoincrement())
  po_id           Int?
  product_id      Int?
  quantity        Int?
  purchase_orders purchase_orders? @relation(fields: [po_id], references: [po_id], onDelete: Restrict, onUpdate: Restrict, map: "fk_po_details_po")
  products        products?        @relation(fields: [product_id], references: [product_id], onDelete: Restrict, onUpdate: Restrict, map: "fk_po_details_product")

  @@index([po_id], map: "fk_po_details_po")
  @@index([product_id], map: "idx_purchase_details_product")
}

model purchase_orders {
  po_id                  Int                      @id @default(autoincrement())
  customer_id            Int?
  order_date             DateTime?                @db.DateTime(0)
  po_status              String?                  @db.VarChar(50)
  outstanding_balance    Decimal?                 @db.Decimal(15, 2)
  handled_by             Int?
  remarks                String?                  @db.VarChar(255)
  purchase_order_details purchase_order_details[]
  PO_sales               PO_sales[]
  customers              customers?               @relation(fields: [customer_id], references: [customer_id], onDelete: Restrict, onUpdate: Restrict, map: "fk_po_customer")
  employees              employees?               @relation(fields: [handled_by], references: [employee_id], onDelete: Restrict, onUpdate: Restrict, map: "fk_po_employee")

  @@index([customer_id], map: "fk_po_customer")
  @@index([handled_by], map: "fk_po_employee")
}

model sale_details {
  sale_detail_id Int       @id @default(autoincrement())
  sale_id        Int?
  product_id     Int?
  quantity       Int?
  unit_price     Decimal?  @db.Decimal(15, 2)
  products       products? @relation(fields: [product_id], references: [product_id], onDelete: Restrict, onUpdate: Restrict, map: "fk_sale_product")
  sales          sales?    @relation(fields: [sale_id], references: [sale_id], onDelete: Restrict, onUpdate: Restrict, map: "fk_sale_sales")

  @@index([sale_id], map: "fk_sale_sales")
  @@index([product_id], map: "idx_sale_details_product")
}

model sales {
  sale_id        Int              @id @default(autoincrement())
  sale_date      DateTime         @db.Date
  sale_status    String?          @db.VarChar(50)
  process_type   String?          @db.VarChar(50)
  remarks        String?          @db.VarChar(255)
  customer_id    Int?
  employee_id    Int?
  sale_type      sales_sale_type? @default(regular)
  created_at     DateTime         @default(now()) @db.Timestamp(0)
  updated_at     DateTime         @default(now()) @db.Timestamp(0)
  amount_paid    Decimal?         @default(0.00) @db.Decimal(15, 2)
  is_active      Boolean          @default(true)
  payment_method String?          @db.VarChar(50)
  total_amount   Decimal?         @default(0.00) @db.Decimal(15, 2)
  delivery       delivery[]
  sale_details   sale_details[]
  PO_sales       PO_sales[]
  customers      customers?       @relation(fields: [customer_id], references: [customer_id], onDelete: Restrict, onUpdate: Restrict, map: "fk_sales_customer")
  employees      employees?       @relation(fields: [employee_id], references: [employee_id], onDelete: Restrict, onUpdate: Restrict, map: "fk_sales_employee")

  @@index([customer_id], map: "idx_sales_customer")
  @@index([employee_id], map: "idx_sales_employee")
}

model stock_log {
  log_id      Int        @id @default(autoincrement())
  product_id  Int?
  change_type String?    @db.VarChar(50)
  quantity    Int?
  reason      String?    @db.VarChar(255)
  log_date    DateTime?  @db.DateTime(0)
  employee_id Int?
  products    products?  @relation(fields: [product_id], references: [product_id], onDelete: Restrict, onUpdate: Restrict, map: "stock_log_ibfk_1")
  employees   employees? @relation(fields: [employee_id], references: [employee_id], onDelete: Restrict, onUpdate: Restrict, map: "stock_log_ibfk_2")

  @@index([employee_id], map: "employee_id")
  @@index([product_id], map: "product_id")
}

model suppliers {
  supplier_id     Int              @id @default(autoincrement())
  supplier_name   String           @unique(map: "unique_supplier_name") @db.VarChar(255)
  contact_number  String?          @db.VarChar(50)
  is_active       Boolean?         @default(true)
  created_at      DateTime?        @default(now()) @db.DateTime(0)
  payable_balance Decimal?         @default(0.00) @db.Decimal(15, 2)
  products        products[]
  supply          supply[]
}

model PO_sales {
  PO_sales_id     Int               @id @default(autoincrement())
  sales_id        Int?
  PO_id           Int?
  sales           sales?            @relation(fields: [sales_id], references: [sale_id], onDelete: Restrict, onUpdate: Restrict)
  purchase_orders purchase_orders?  @relation(fields: [PO_id], references: [po_id], onDelete: Restrict, onUpdate: Restrict)
  customer_credit customer_credit[]

  @@index([sales_id], map: "fk_po_sales_sale")
  @@index([PO_id], map: "fk_po_sales_po")
}

model customer_credit {
  credit_id         Int       @id @default(autoincrement())
  PO_sale_id        Int?
  credit_amountpaid Decimal?  @db.Decimal(15, 2)
  last_payment_date DateTime? @db.Date
  type_payment      Int?
  PO_sales          PO_sales? @relation(fields: [PO_sale_id], references: [PO_sales_id], onDelete: Restrict, onUpdate: Restrict)

  @@index([PO_sale_id], map: "fk_credit_po_sale")
}

model supply {
  supply_id      Int              @id @default(autoincrement())
  supply_date    DateTime?        @db.Date
  employee_id    Int?
  supplier_id    Int?
  total          Decimal?         @db.Decimal(15, 2)
  employees      employees?       @relation(fields: [employee_id], references: [employee_id], onDelete: Restrict, onUpdate: Restrict)
  suppliers      suppliers?       @relation(fields: [supplier_id], references: [supplier_id], onDelete: Restrict, onUpdate: Restrict)
  supply_details supply_details[]

  @@index([employee_id], map: "fk_supply_employee")
  @@index([supplier_id], map: "fk_supply_supplier")
}

model supply_details {
  supply_detail_id Int       @id @default(autoincrement())
  supply_id        Int?
  product_id       Int?
  unit_type        String?   @db.VarChar(50)
  unit_quantity    Int?
  unit_cost        Decimal?  @db.Decimal(15, 2)
  supply           supply?   @relation(fields: [supply_id], references: [supply_id], onDelete: Restrict, onUpdate: Restrict)
  products         products? @relation(fields: [product_id], references: [product_id], onDelete: Restrict, onUpdate: Restrict)

  @@index([supply_id], map: "fk_supply_detail_supply")
  @@index([product_id], map: "fk_supply_detail_product")
}

model users {
  user_id       Int        @id @default(autoincrement())
  username      String     @unique @db.VarChar(50)
  password_hash String     @db.VarChar(255)
  full_name     String     @db.VarChar(100)
  role          users_role @default(CASHIER)
  is_active     Boolean    @default(true)
  created_at    DateTime   @default(now())
  updated_at    DateTime
}

enum account_ledger_account_type {
  customer
  supplier
  employee
}

enum users_role {
  CASHIER
  CLERK
  MANAGER
}

enum sales_sale_type {
  regular
  pos
}

enum products_source {
  local
  import
}
